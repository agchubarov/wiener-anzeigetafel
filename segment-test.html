<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LED Segment Test - Wien U-Bahn</title>
    <style>
        :root {
            --led-yellow-green: #c8e000;
            --led-glow: rgba(184, 233, 134, 0.6);
            --led-dim: #0a1a10;
            --bg-dark: #0a0a0a;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            min-height: 100vh;
            background: var(--bg-dark);
            color: #fff;
            font-family: system-ui, sans-serif;
            padding: 2rem;
        }

        h1 {
            color: var(--led-yellow-green);
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }

        /* Controls */
        .controls {
            display: flex;
            gap: 1rem;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .controls input {
            font-size: 1.5rem;
            padding: 0.5rem 1rem;
            width: 3rem;
            text-align: center;
            background: #1a1a1a;
            border: 1px solid #333;
            color: #fff;
            border-radius: 4px;
            text-transform: uppercase;
        }

        .controls label {
            color: #888;
        }

        .controls button {
            padding: 0.5rem 1rem;
            background: #333;
            border: none;
            color: #fff;
            border-radius: 4px;
            cursor: pointer;
        }

        .controls button:hover {
            background: #444;
        }

        /* LED Cell Container */
        .led-cell-demo {
            display: inline-block;
            background: #0d1a10;
            border: 1px solid #1a3020;
            border-radius: 2px;
            margin-bottom: 2rem;
        }

        /* LED Segment SVG */
        .led-segment {
            display: block;
            width: 55px;
            height: 98px;
        }

        /* All segments start dim */
        .led-segment .segment {
            fill: var(--led-dim);
            transition: fill 300ms ease, filter 300ms ease;
        }

        /* Lit segments glow */
        .led-segment .segment.lit {
            fill: var(--led-yellow-green);
            filter: drop-shadow(0 0 4px var(--led-glow));
        }

        /* Multiple cells preview */
        .multi-preview {
            margin-top: 2rem;
        }

        .multi-preview h2 {
            color: #888;
            font-size: 1rem;
            margin-bottom: 1rem;
        }

        .led-row-demo {
            display: flex;
            gap: 4px;
            background: #1e1e1e;
            padding: 8px;
            border-radius: 4px;
            overflow-x: auto;
        }

        .led-row-demo .led-cell-demo {
            margin: 0;
        }

        .led-row-demo .led-segment {
            width: 40px;
            height: 71px;
        }

        /* Segment info */
        .segment-info {
            margin-top: 2rem;
            color: #666;
            font-size: 0.875rem;
        }

        .segment-count {
            color: var(--led-yellow-green);
        }
    </style>
</head>

<body>
    <h1>LED Segment Test</h1>

    <div class="controls">
        <label>Character:</label>
        <input type="text" id="char-input" maxlength="1" value="A">
        <button id="prev-btn">← Prev</button>
        <button id="next-btn">Next →</button>
        <button id="toggle-all-btn">Toggle All</button>
    </div>

    <div class="led-cell-demo">
        <svg id="led-display" class="led-segment" viewBox="8.346 8.578 54.908 97.526"
            xmlns="http://www.w3.org/2000/svg">
            <!-- Base template with all segments - to be populated by script -->
        </svg>
    </div>

    <div class="segment-info">
        Lit segments: <span id="segment-count" class="segment-count">0</span> / <span id="total-segments">84</span>
    </div>

    <div class="multi-preview">
        <h2>Multi-cell preview:</h2>
        <div id="led-row" class="led-row-demo"></div>
    </div>

    <script type="module">
        import { SEGMENT_MAP, BASE_SEGMENTS, ALL_SEGMENT_IDS, TOTAL_SEGMENTS } from './src/segment-map.ts';

        // Update total segments display
        document.getElementById('total-segments').textContent = TOTAL_SEGMENTS;


        // Initialize the SVG display
        function initDisplay() {
            const svg = document.getElementById('led-display');
            svg.innerHTML = BASE_SEGMENTS.map(seg =>
                `<path id="${seg.id}" class="segment" d="${seg.d}" />`
            ).join('');
        }

        // Light up segments for a character
        function displayCharacter(char) {
            // Only uppercase basic a-z letters (ß.toUpperCase() returns 'SS' which breaks lookup)
            const normalizedChar = /^[a-z]$/i.test(char) ? char.toUpperCase() : char;
            const litSegments = SEGMENT_MAP[normalizedChar] || [];

            // Reset all segments
            ALL_SEGMENT_IDS.forEach(id => {
                const path = document.getElementById(id);
                if (path) path.classList.remove('lit');
            });

            // Light up the correct segments
            litSegments.forEach(id => {
                const path = document.getElementById(id);
                if (path) path.classList.add('lit');
            });

            // Update count
            document.getElementById('segment-count').textContent = litSegments.length;
        }

        // Create an LED cell SVG for a character
        function createCellSVG(char) {
            // Only uppercase basic a-z letters (ß.toUpperCase() returns 'SS' which breaks lookup)
            const normalizedChar = /^[a-z]$/i.test(char) ? char.toUpperCase() : char;
            const litSegments = SEGMENT_MAP[normalizedChar] || [];
            const paths = BASE_SEGMENTS.map(seg => {
                const isLit = litSegments.includes(seg.id);
                return `<path class="segment${isLit ? ' lit' : ''}" d="${seg.d}" />`;
            }).join('');

            return `
        <div class="led-cell-demo">
          <svg class="led-segment" viewBox="8.346 8.578 54.908 97.526" xmlns="http://www.w3.org/2000/svg">
            ${paths}
          </svg>
        </div>
      `;
        }

        // Update multi-cell preview
        function updateMultiPreview(text) {
            const row = document.getElementById('led-row');
            row.innerHTML = text.split('').map(char => createCellSVG(char)).join('');
        }

        // Toggle all segments using full block character █ (U+2588)
        function toggleAllSegments() {
            const fullBlockSegments = SEGMENT_MAP['█'] || [];
            const allLit = fullBlockSegments.length > 0 && fullBlockSegments.every(id => {
                const path = document.getElementById(id);
                return path && path.classList.contains('lit');
            });

            if (allLit) {
                // Turn all off (display space)
                displayCharacter(' ');
                document.getElementById('char-input').value = '';
            } else {
                // Display full block character █
                displayCharacter('█');
                document.getElementById('char-input').value = '█';
            }
        }

        // Character navigation - all available characters from SEGMENT_MAP
        const CHARS_ALPHA = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
        const CHARS_NUMERIC = '0123456789';
        const CHARS_UMLAUT = 'ÄÖÜß';
        const CHARS_PUNCT = Object.keys(SEGMENT_MAP).filter(
            c => !CHARS_ALPHA.includes(c) && !CHARS_NUMERIC.includes(c) && !CHARS_UMLAUT.includes(c) && c !== ' '
        ).join('');
        const CHARS = ' ' + CHARS_ALPHA + CHARS_NUMERIC + CHARS_UMLAUT + CHARS_PUNCT;
        let currentCharIndex = 1; // Start at 'A'

        function prevChar() {
            currentCharIndex = (currentCharIndex - 1 + CHARS.length) % CHARS.length;
            const char = CHARS[currentCharIndex];
            document.getElementById('char-input').value = char === ' ' ? '' : char;
            displayCharacter(char);
        }

        function nextChar() {
            currentCharIndex = (currentCharIndex + 1) % CHARS.length;
            const char = CHARS[currentCharIndex];
            document.getElementById('char-input').value = char === ' ' ? '' : char;
            displayCharacter(char);
        }

        // Initialize
        initDisplay();
        displayCharacter('A');
        updateMultiPreview('WIEN');

        // Event listeners
        document.getElementById('char-input').addEventListener('input', (e) => {
            const rawChar = e.target.value || ' ';
            // Only uppercase if it's a basic letter (ß.toUpperCase() returns 'SS' which breaks lookup)
            const char = /^[a-z]$/i.test(rawChar) ? rawChar.toUpperCase() : rawChar;
            displayCharacter(char);
            currentCharIndex = CHARS.indexOf(char);
            if (currentCharIndex === -1) currentCharIndex = 0;
        });

        document.getElementById('prev-btn').addEventListener('click', prevChar);
        document.getElementById('next-btn').addEventListener('click', nextChar);
        document.getElementById('toggle-all-btn').addEventListener('click', toggleAllSegments);
    </script>
</body>

</html>